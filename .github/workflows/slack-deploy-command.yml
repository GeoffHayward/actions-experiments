name: Slack Deployment Command

on:
  repository_dispatch:
    types:
      - slack-deploy-command

jobs:
  build:
    name: Build Commit
    runs-on: ubuntu-latest
    env:
      PAYLOAD_CONTEXT: ${{ toJson(github.event.client_payload) }}
      BRANCH: ${{ github.event.client_payload.data.text }}
      CHANNEL_ID: ${{ github.event.client_payload.data.channel_id }}
      RESPONSE_URL: ${{  github.event.client_payload.data.response_url }}
      USER_NAME: ${{  github.event.client_payload.data.user_name }}
      TOKEN: ${{  github.event.client_payload.data.token }}


    steps:

      # For debugging
      - name: Print payload values
        run: |
          echo "PAYLOAD_CONTEXT: $PAYLOAD_CONTEXT"
          echo "BRANCH: $BRANCH"
          echo "CHANNEL_ID: $CHANNEL_ID"
          echo "RESPONSE_URL: $RESPONSE_URL"
          echo "USER_NAME: $USER_NAME"
          echo "PAYLOAD_CONTEXT: $PAYLOAD_CONTEXT"
          echo "TOKEN: $TOKEN"

      - name: Identify target
        uses: actions/github-script@v3
        id: find-target
        with:
          script: |
            const environments = {
              C01KGP0B78R: 'debugging'
            }
            if(environments[`$CHANNEL_ID`] === undefined) {
              return environments[`$CHANNEL_ID`]
            } else {
              core.setFailed("No target environment has been identifed.")
            }

      # if fail send slack message

      - name: Print Identify target
        run: |
          echo "${{steps.find-target.outputs.result}}"
